<!doctype html><html lang=en data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://backslashphp.github.io/backslash/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://backslashphp.github.io/backslash/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://backslashphp.github.io/backslash/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><script src=/backslash/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href="/backslash/main.2c8d1a801c07c4d38f613bfa9e2c460c44b6a28e1bc6d92822d03866795a8130ad3c77c7a8f2ea47565e81d2c5b2b8cfd9c2e9c69cb47d6c31b40bad5ad98e0d.css" integrity="sha512-LI0agBwHxNOPYTv6nixGDES2oo4bxtkoItA4ZnlagTCtPHfHqPLqR1ZegdLFsrjP2cLpxpy0fWwxtAutWtmODQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://backslashphp.github.io/backslash/docs/maintenance/rebuilding-projections/><link rel=canonical href=https://backslashphp.github.io/backslash/docs/maintenance/rebuilding-projections/><title>Rebuilding Projections | Backslash PHP</title><meta name=description content="CQRS & Event Sourcing for PHP"><link rel=icon href=/backslash/favicon.ico sizes=32x32><link rel=icon href=/backslash/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/backslash/backslash/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/backslash/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/backslash/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/backslash/manifest.webmanifest><meta property="og:url" content="https://backslashphp.github.io/backslash/docs/maintenance/rebuilding-projections/"><meta property="og:site_name" content="Backslash PHP"><meta property="og:title" content="Rebuilding Projections"><meta property="og:description" content="Rebuilding projections is a routine task in event-sourced applications. This capability allows you to reconstruct read models from scratch by replaying the complete event history."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="og:image" content="https://backslashphp.github.io/backslash/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://backslashphp.github.io/backslash/cover.png"><meta name=twitter:title content="Rebuilding Projections"><meta name=twitter:description content="Rebuilding projections is a routine task in event-sourced applications. This capability allows you to reconstruct read models from scratch by replaying the complete event history."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://backslashphp.github.io/backslash/","name":"Cqrs \u0026 Event Sourcing for Php","position":1},{"@type":"ListItem","item":"https://backslashphp.github.io/backslash/docs/","name":"Documentation","position":2},{"@type":"ListItem","item":"https://backslashphp.github.io/backslash/docs/maintenance/","name":"Maintenance","position":3},{"@type":"ListItem","name":"Rebuilding Projections","position":4}]}</script></head><body class="single section docs" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg"><div class=container-lg><a class="navbar-brand me-auto me-lg-3" href=/backslash/>Backslash PHP</a>
<button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu">
<svg class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Docs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details open><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/getting-started/introduction/>Introduction</a></li><li><a href=/backslash/docs/getting-started/architecture-overview/>Architecture Overview</a></li><li><a href=/backslash/docs/getting-started/quick-start-guide/>Quick Start Guide</a></li></ul></details></li><li><details open><summary>Event Sourcing</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/event-sourcing/understanding-event-sourcing/>Understanding Event Sourcing</a></li><li><a href=/backslash/docs/event-sourcing/defining-events/>Defining Events</a></li><li><a href=/backslash/docs/event-sourcing/querying-events/>Querying Events</a></li><li><a href=/backslash/docs/event-sourcing/building-models/>Building Models</a></li></ul></details></li><li><details open><summary>Commands and Projections (CQRS)</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/cqrs/understanding-cqrs/>Understanding CQRS</a></li><li><a href=/backslash/docs/cqrs/dispatching-commands/>Dispatching Commands</a></li><li><a href=/backslash/docs/cqrs/reacting-with-event-handlers/>Reacting with Event Handlers</a></li><li><a href=/backslash/docs/cqrs/building-projections/>Building Projections</a></li></ul></details></li><li><details open><summary>Testing Your Application</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/testing/setting-up-tests/>Setting Up Tests</a></li><li><a href=/backslash/docs/testing/writing-test-scenarios/>Writing Test Scenarios</a></li></ul></details></li><li><details open><summary>Customization</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/customization/extending-with-middleware/>Extending with Middleware</a></li><li><a href=/backslash/docs/customization/enriching-event-streams/>Enriching Event Streams</a></li></ul></details></li><li><details open><summary>Application Setup</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/application-setup/defining-services/>Defining Services</a></li><li><a href=/backslash/docs/application-setup/registering-handlers/>Registering Handlers</a></li><li><a href=/backslash/docs/application-setup/using-the-bootstrap-file/>Using the Bootstrap File</a></li></ul></details></li><li><details open open><summary>Maintenance</summary><ul class="list-unstyled list-nested"><li class=active><a aria-current=page href=/backslash/docs/maintenance/rebuilding-projections/>Rebuilding Projections</a></li></ul></details></li></ul></nav></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu">
<svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class="header-bar d-lg-none"></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>Backslash PHP</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://backslashphp.github.io/backslash/docs/getting-started/introduction/>Documentation</a></li><li class=nav-item><a class=nav-link href=https://github.com/backslashphp/demo>Demo</a></li><li class=nav-item><a class=nav-link href=https://backslashphp.github.io/backslash/blog/>Blog</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme">
<svg data-bs-theme-value="dark" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg>
<svg data-bs-theme-value="light" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/backslashphp/backslash><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul></div></div></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=UTF-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search indexâ€¦</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class="submitted d-none"><time class=created-date>Date here</time></div></header><div class=content>Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-lg" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar docs-sidebar-offset d-none d-lg-block"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details open><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/getting-started/introduction/>Introduction</a></li><li><a href=/backslash/docs/getting-started/architecture-overview/>Architecture Overview</a></li><li><a href=/backslash/docs/getting-started/quick-start-guide/>Quick Start Guide</a></li></ul></details></li><li><details open><summary>Event Sourcing</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/event-sourcing/understanding-event-sourcing/>Understanding Event Sourcing</a></li><li><a href=/backslash/docs/event-sourcing/defining-events/>Defining Events</a></li><li><a href=/backslash/docs/event-sourcing/querying-events/>Querying Events</a></li><li><a href=/backslash/docs/event-sourcing/building-models/>Building Models</a></li></ul></details></li><li><details open><summary>Commands and Projections (CQRS)</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/cqrs/understanding-cqrs/>Understanding CQRS</a></li><li><a href=/backslash/docs/cqrs/dispatching-commands/>Dispatching Commands</a></li><li><a href=/backslash/docs/cqrs/reacting-with-event-handlers/>Reacting with Event Handlers</a></li><li><a href=/backslash/docs/cqrs/building-projections/>Building Projections</a></li></ul></details></li><li><details open><summary>Testing Your Application</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/testing/setting-up-tests/>Setting Up Tests</a></li><li><a href=/backslash/docs/testing/writing-test-scenarios/>Writing Test Scenarios</a></li></ul></details></li><li><details open><summary>Customization</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/customization/extending-with-middleware/>Extending with Middleware</a></li><li><a href=/backslash/docs/customization/enriching-event-streams/>Enriching Event Streams</a></li></ul></details></li><li><details open><summary>Application Setup</summary><ul class="list-unstyled list-nested"><li><a href=/backslash/docs/application-setup/defining-services/>Defining Services</a></li><li><a href=/backslash/docs/application-setup/registering-handlers/>Registering Handlers</a></li><li><a href=/backslash/docs/application-setup/using-the-bootstrap-file/>Using the Bootstrap File</a></li></ul></details></li><li><details open open><summary>Maintenance</summary><ul class="list-unstyled list-nested"><li class=active><a aria-current=page href=/backslash/docs/maintenance/rebuilding-projections/>Rebuilding Projections</a></li></ul></details></li></ul></nav></div><nav class="docs-toc docs-toc-offset d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#understanding-when-to-rebuild>Understanding when to rebuild</a></li><li><a href=#treating-projections-as-disposable>Treating projections as disposable</a></li><li><a href=#distinguishing-projectors-from-processors>Distinguishing projectors from processors</a></li><li><a href=#understanding-eventstore-and-inspector>Understanding EventStore and Inspector</a></li><li><a href=#filtering-events-during-replay>Filtering events during replay</a></li><li><a href=#tracking-rebuild-progress>Tracking rebuild progress</a></li><li><a href=#the-serial-rebuild-process>The serial rebuild process</a></li><li><a href=#disabling-stream-enrichment>Disabling stream enrichment</a></li><li><a href=#implementing-parallel-rebuilds>Implementing parallel rebuilds</a></li><li><a href=#filtering-events-for-parallel-rebuilds>Filtering events for parallel rebuilds</a></li><li><a href=#best-practices>Best practices</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Rebuilding Projections</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#understanding-when-to-rebuild>Understanding when to rebuild</a></li><li><a href=#treating-projections-as-disposable>Treating projections as disposable</a></li><li><a href=#distinguishing-projectors-from-processors>Distinguishing projectors from processors</a></li><li><a href=#understanding-eventstore-and-inspector>Understanding EventStore and Inspector</a></li><li><a href=#filtering-events-during-replay>Filtering events during replay</a></li><li><a href=#tracking-rebuild-progress>Tracking rebuild progress</a></li><li><a href=#the-serial-rebuild-process>The serial rebuild process</a></li><li><a href=#disabling-stream-enrichment>Disabling stream enrichment</a></li><li><a href=#implementing-parallel-rebuilds>Implementing parallel rebuilds</a></li><li><a href=#filtering-events-for-parallel-rebuilds>Filtering events for parallel rebuilds</a></li><li><a href=#best-practices>Best practices</a></li></ul></nav></div></details></nav><p>Rebuilding projections is a routine task in event-sourced applications. This capability allows you to reconstruct read
models from scratch by replaying the complete event history.</p><p>Backslash does not provide a built-in component specifically for rebuilding projections; each application has unique
requirements and should implement rebuilding according to its specific needs. However, Backslash provides essential
tools that facilitate the rebuild process, such as the <code>Inspector</code> for replaying events, the <code>ProjectionStore</code> for
managing projection lifecycle, and the <code>EventBus</code> for routing events to projectors.</p><h2 id=understanding-when-to-rebuild>Understanding when to rebuild<a href=#understanding-when-to-rebuild class=anchor aria-hidden=true>#</a></h2><p>Rebuild projections when:</p><ul><li><strong>Creating new projections</strong>: New read models need historical data from existing events</li><li><strong>Modifying projection logic</strong>: Changes to how projections interpret events require rebuilding with the updated logic</li><li><strong>Optimizing projection structure</strong>: Performance improvements or schema changes necessitate reconstruction</li><li><strong>Fixing projection bugs</strong>: Corrected projector logic must be applied to all historical events</li><li><strong>Migrating projection storage</strong>: Moving projections to different storage systems requires rebuilding in the new
location</li></ul><h2 id=treating-projections-as-disposable>Treating projections as disposable<a href=#treating-projections-as-disposable class=anchor aria-hidden=true>#</a></h2><p>Because events are the source of truth, projections are disposable and easily reconstructed. Events represent what
actually happened in your system; projections are merely interpretations of those events. While projections may
occasionally contain errors due to bugs in projector logic, events always tell the truth.</p><p>This fundamental principle means you can confidently delete and rebuild projections whenever needed. The ability to
rebuild projections is what makes CQRS practical for evolving systems.</p><h2 id=distinguishing-projectors-from-processors>Distinguishing projectors from processors<a href=#distinguishing-projectors-from-processors class=anchor aria-hidden=true>#</a></h2><p>Before rebuilding, understand the critical difference between two types of event handlers:</p><p><strong>Projectors</strong> update projections by reading events and storing read models. They are idempotent and side-effect-free
beyond projection updates. Examples include:</p><ul><li>Building course lists from <code>CourseDefinedEvent</code></li><li>Updating student enrollments from <code>StudentSubscribedToCourseEvent</code></li><li>Maintaining dashboard metrics from various events</li></ul><p><strong>Processors</strong> trigger side effects like sending notifications, calling external APIs, or publishing to message queues.
They should not execute during rebuilds. Examples include:</p><ul><li>Sending confirmation emails when students subscribe to courses</li><li>Notifying external systems of state changes</li><li>Publishing events to message brokers</li></ul><p>During rebuilds, register only projectors; never register processors. Processors should execute only once when events
first occur, not during historical replays.</p><h2 id=understanding-eventstore-and-inspector>Understanding EventStore and Inspector<a href=#understanding-eventstore-and-inspector class=anchor aria-hidden=true>#</a></h2><p>Normal operations use the <code>Repository</code> to load models and persist changes. Rebuilding requires direct access to the
<code>EventStore</code> and <code>EventBus</code> using the <code>Inspector</code> component.</p><p>The <code>EventStore</code> provides an append-only, queryable log of all events. The <code>Inspector</code> iterates through stored events
and publishes them to the <code>EventBus</code>:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>Backslash\StreamPublishingInspection\Inspector</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$inspector</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Inspector</span><span class=p>(</span><span class=nv>$eventBus</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventStore</span><span class=o>-&gt;</span><span class=na>inspect</span><span class=p>(</span><span class=nv>$inspector</span><span class=p>);</span></span></span></code></pre></div></figure></div><p>This replays every event in the EventStore, triggering all registered event handlers as if the events were just
published.</p><h2 id=filtering-events-during-replay>Filtering events during replay<a href=#filtering-events-during-replay class=anchor aria-hidden=true>#</a></h2><p>The <code>Inspector</code> optionally accepts a <code>Query</code> as its second constructor argument to retrieve only a subset of events from
the EventStore. This is particularly useful when rebuilding a single projector; you can pass a query that selects only
events relevant to that projector:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>Backslash\StreamPublishingInspection\Inspector</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Backslash\EventStore\Query\EventClass</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Define which events the projector needs
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$relevantEvents</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=nx>CourseDefinedEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>CourseCapacityChangedEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>StudentSubscribedToCourseEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create a query filtering for these events only
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$query</span> <span class=o>=</span> <span class=nx>EventClass</span><span class=o>::</span><span class=na>in</span><span class=p>(</span><span class=nv>$relevantEvents</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Inspector will only replay these specific events
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$inspector</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Inspector</span><span class=p>(</span><span class=nv>$eventBus</span><span class=p>,</span> <span class=nv>$query</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventStore</span><span class=o>-&gt;</span><span class=na>inspect</span><span class=p>(</span><span class=nv>$inspector</span><span class=p>);</span></span></span></code></pre></div></figure></div><p>Without a query parameter, the <code>Inspector</code> replays all events in the EventStore. When rebuilding all projections, omit
the query; when rebuilding specific projections, use <code>EventClass::in()</code> to filter for only the necessary events.</p><h2 id=tracking-rebuild-progress>Tracking rebuild progress<a href=#tracking-rebuild-progress class=anchor aria-hidden=true>#</a></h2><p>The <code>Inspector</code> optionally accepts third and fourth constructor arguments as closures for tracking rebuild progress. The
first closure executes before dispatching each event to the EventBus; the second executes after dispatch:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$eventCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$totalEvents</span> <span class=o>=</span> <span class=nv>$eventStore</span><span class=o>-&gt;</span><span class=na>count</span><span class=p>();</span> <span class=c1>// Hypothetical method
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$beforeDispatch</span> <span class=o>=</span> <span class=k>function</span> <span class=p>(</span><span class=nx>RecordedEvent</span> <span class=nv>$recordedEvent</span><span class=p>)</span> <span class=k>use</span> <span class=p>(</span><span class=o>&amp;</span><span class=nv>$eventCount</span><span class=p>,</span> <span class=nv>$totalEvents</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$eventCount</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>sprintf</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Processing event %d/%d: %s</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nv>$eventCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nv>$totalEvents</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nv>$recordedEvent</span><span class=o>-&gt;</span><span class=na>getEvent</span><span class=p>()</span><span class=o>::</span><span class=na>class</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$afterDispatch</span> <span class=o>=</span> <span class=k>function</span> <span class=p>(</span><span class=nx>RecordedEvent</span> <span class=nv>$recordedEvent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Log completion, update progress bar, etc.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$inspector</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Inspector</span><span class=p>(</span><span class=nv>$eventBus</span><span class=p>,</span> <span class=nv>$query</span><span class=p>,</span> <span class=nv>$beforeDispatch</span><span class=p>,</span> <span class=nv>$afterDispatch</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventStore</span><span class=o>-&gt;</span><span class=na>inspect</span><span class=p>(</span><span class=nv>$inspector</span><span class=p>);</span></span></span></code></pre></div></figure></div><p>These callbacks are particularly useful for outputting progress to the console, calculating completion percentages, or
logging rebuild metrics.</p><hr><h2 id=the-serial-rebuild-process>The serial rebuild process<a href=#the-serial-rebuild-process class=anchor aria-hidden=true>#</a></h2><p>Rebuilding follows these steps:</p><ol><li><strong>Bootstrap the application</strong> with only projectors registered; exclude all processors to prevent side effects</li><li><strong>Delete existing projections</strong> by calling <code>purge()</code> on the <code>ProjectionStore</code></li><li><strong>Disable stream enricher</strong> if your application uses one; metadata enrichment must not occur during replays</li><li><strong>Load all events chronologically</strong> from the EventStore and publish them to the EventBus using Inspector</li><li><strong>Commit rebuilt projections</strong> by calling <code>commit()</code> on the ProjectionStore</li></ol><p>The serial approach processes events sequentially, looping through all events one after the other in a single PHP
process. Here&rsquo;s a complete serial rebuild implementation:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>declare</span><span class=p>(</span><span class=nx>strict_types</span><span class=o>=</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Backslash\CommandDispatcher\DispatcherInterface</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Backslash\EventBus\EventBusInterface</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Backslash\EventStore\EventStoreInterface</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Backslash\ProjectionStore\ProjectionStoreInterface</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Backslash\StreamPublishingInspection\Inspector</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Demo\UI\Projection\CourseList\CourseListProjector</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Demo\UI\Projection\StudentList\StudentListProjector</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Psr\Container\ContainerInterface</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/** @var ContainerInterface $container */</span>
</span></span><span class=line><span class=cl><span class=nv>$container</span> <span class=o>=</span> <span class=k>require</span> <span class=no>__DIR__</span> <span class=o>.</span> <span class=s1>&#39;/../bootstrap.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/** @var EventStoreInterface $eventStore */</span>
</span></span><span class=line><span class=cl><span class=nv>$eventStore</span> <span class=o>=</span> <span class=nv>$container</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=nx>EventStoreInterface</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/** @var ProjectionStoreInterface $projectionStore */</span>
</span></span><span class=line><span class=cl><span class=nv>$projectionStore</span> <span class=o>=</span> <span class=nv>$container</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=nx>ProjectionStoreInterface</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create a dedicated EventBus with only projectors
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$eventBus</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventBus</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Register projectors (not processors)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$courseListProjector</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CourseListProjector</span><span class=p>(</span><span class=nv>$projectionStore</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$studentListProjector</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>StudentListProjector</span><span class=p>(</span><span class=nv>$projectionStore</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nx>CourseDefinedEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$courseListProjector</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nx>CourseCapacityChangedEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$courseListProjector</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nx>StudentSubscribedToCourseEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$courseListProjector</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nx>StudentUnsubscribedFromCourseEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$courseListProjector</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nx>StudentRegisteredEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$courseListProjector</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nx>CourseDefinedEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$studentListProjector</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nx>StudentRegisteredEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$studentListProjector</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nx>StudentSubscribedToCourseEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$studentListProjector</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nx>StudentUnsubscribedFromCourseEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$studentListProjector</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Step 1: Purge existing projections
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$projectionStore</span><span class=o>-&gt;</span><span class=na>purge</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$projectionStore</span><span class=o>-&gt;</span><span class=na>commit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;Purged existing projections</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Step 2: Replay all events
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$inspector</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Inspector</span><span class=p>(</span><span class=nv>$eventBus</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventStore</span><span class=o>-&gt;</span><span class=na>inspect</span><span class=p>(</span><span class=nv>$inspector</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;Replayed all events</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Step 3: Commit rebuilt projections
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$projectionStore</span><span class=o>-&gt;</span><span class=na>commit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;Rebuild complete</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span></span></span></code></pre></div></figure></div><p>This serial approach is effective for getting started but processes events sequentially in a single PHP process.</p><h2 id=disabling-stream-enrichment>Disabling stream enrichment<a href=#disabling-stream-enrichment class=anchor aria-hidden=true>#</a></h2><p>If your application uses a stream enricher, disable it during rebuilds to prevent metadata enrichment. Stream enrichers
typically add contextual information like user IDs, tenant identifiers, or correlation IDs to events as they occur.</p><p>During rebuilds, you&rsquo;re replaying historical events that already contain their original metadata. Re-enriching them
would:</p><ul><li>Add incorrect contextual data from the rebuild process rather than the original context</li><li>Potentially modify event metadata in unintended ways</li><li>Cause unnecessary processing overhead</li></ul><p>Disable enrichment by not registering the enricher middleware when bootstrapping your rebuild script:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// Normal application bootstrap registers enricher middleware
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$eventStore</span><span class=o>-&gt;</span><span class=na>addMiddleware</span><span class=p>(</span><span class=k>new</span> <span class=nx>StreamEnricherEventStoreMiddleware</span><span class=p>(</span><span class=nv>$enricher</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>addMiddleware</span><span class=p>(</span><span class=k>new</span> <span class=nx>StreamEnricherEventBusMiddleware</span><span class=p>(</span><span class=nv>$enricher</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Rebuild script omits enricher middleware entirely
</span></span></span><span class=line><span class=cl><span class=c1>// Just use EventStore and EventBus without enricher middleware
</span></span></span></code></pre></div></figure></div><p>Alternatively, implement methods like <code>enable()</code> and <code>disable()</code> on your stream enricher to toggle activation:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>StreamEnricher</span> <span class=k>implements</span> <span class=nx>StreamEnricherInterface</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nx>bool</span> <span class=nv>$enabled</span> <span class=o>=</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>enable</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>enabled</span> <span class=o>=</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>disable</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>enabled</span> <span class=o>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>enrich</span><span class=p>(</span><span class=nx>EventStreamInterface</span> <span class=nv>$stream</span><span class=p>)</span><span class=o>:</span> <span class=nx>EventStreamInterface</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>enabled</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nv>$stream</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Enrichment logic here
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// In rebuild script
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$enricher</span><span class=o>-&gt;</span><span class=na>disable</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// After rebuild
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$enricher</span><span class=o>-&gt;</span><span class=na>enable</span><span class=p>();</span></span></span></code></pre></div></figure></div><p>This approach allows you to keep the enricher middleware registered while controlling when enrichment occurs.</p><h2 id=implementing-parallel-rebuilds>Implementing parallel rebuilds<a href=#implementing-parallel-rebuilds class=anchor aria-hidden=true>#</a></h2><p>For large event stores, parallel rebuilding improves performance by running each projector in a separate PHP process.
This approach reduces memory consumption and CPU usage by distributing work across multiple workers.</p><p>One suggested parallel rebuild strategy involves two scripts:</p><p><strong>Main coordinator script</strong> that:</p><ul><li>Deletes all existing projections</li><li>Loops through all projectors</li><li>Launches a background process for each projector, passing the projector class name as an argument</li><li>Waits for all background processes to complete</li></ul><p><strong>Worker script</strong> that:</p><ul><li>Receives the projector class name as an argument</li><li>Determines which events the projector is interested in</li><li>Creates a query filtering for those specific events using <code>EventClass::in()</code></li><li>Uses the <code>Inspector</code> with this query to replay only the relevant events</li><li>Creates a dedicated EventBus and registers only that projector</li><li>Instructs the EventStore to inspect using the filtered Inspector</li><li>Commits the rebuilt projections for that projector only</li></ul><p>This approach allows each projector to process only its relevant events independently, enabling true parallel execution
where multiple projectors rebuild simultaneously in separate PHP processes.</p><p>Each worker performs its own <code>commit()</code>, ensuring that projections are persisted independently.</p><p><strong>Important</strong>: This parallel method requires projectors to be fully autonomous. Projectors must not depend on
projections built by other projectors, as those projections may not be available when needed during concurrent
execution. Each projector should derive all necessary information solely from events. When projectors are autonomous,
there is no risk of conflicts between workers since each projector manages distinct projections.</p><hr><h2 id=filtering-events-for-parallel-rebuilds>Filtering events for parallel rebuilds<a href=#filtering-events-for-parallel-rebuilds class=anchor aria-hidden=true>#</a></h2><p>When implementing the worker script, use the <code>Inspector</code> with a query to replay only events relevant to the specific
projector. Adding a static method to each projector that returns its subscribed events simplifies worker scripts and
centralizes event subscription knowledge:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>CourseListProjector</span> <span class=k>implements</span> <span class=nx>EventHandlerInterface</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nx>EventHandlerTrait</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>getSubscribedEvents</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=nx>CourseDefinedEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>CourseCapacityChangedEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>StudentSubscribedToCourseEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>StudentUnsubscribedFromCourseEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Handler methods...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></div></figure></div><p>The worker script can then call this method to determine which events to load:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>Backslash\EventStore\Query\EventClass</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Backslash\StreamPublishingInspection\Inspector</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Worker receives projector class name as argument
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$projectorClass</span> <span class=o>=</span> <span class=nv>$argv</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span> <span class=c1>// e.g., CourseListProjector::class
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Get subscribed events from projector
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$eventClasses</span> <span class=o>=</span> <span class=nv>$projectorClass</span><span class=o>::</span><span class=na>getSubscribedEvents</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create query to filter for relevant events only
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$query</span> <span class=o>=</span> <span class=nx>EventClass</span><span class=o>::</span><span class=na>in</span><span class=p>(</span><span class=nv>$eventClasses</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create and register projector
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$eventBus</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EventBus</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$projector</span> <span class=o>=</span> <span class=k>new</span> <span class=nv>$projectorClass</span><span class=p>(</span><span class=nv>$projectionStore</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$eventClasses</span> <span class=k>as</span> <span class=nv>$eventClass</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nv>$eventClass</span><span class=p>,</span> <span class=nv>$projector</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create Inspector with the filtering query
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$inspector</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Inspector</span><span class=p>(</span><span class=nv>$eventBus</span><span class=p>,</span> <span class=nv>$query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Replay only the filtered events
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$eventStore</span><span class=o>-&gt;</span><span class=na>inspect</span><span class=p>(</span><span class=nv>$inspector</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Commit the rebuilt projections
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$projectionStore</span><span class=o>-&gt;</span><span class=na>commit</span><span class=p>();</span></span></span></code></pre></div></figure></div><p>This pattern ensures each worker processes only its necessary events, avoiding unnecessary event handling and improving
rebuild performance. The <code>Inspector</code> with the query guarantees that only relevant events are replayed through the
EventBus.</p><hr><h2 id=best-practices>Best practices<a href=#best-practices class=anchor aria-hidden=true>#</a></h2><p><strong>Make the application unavailable during rebuilds.</strong> The application should not be accessible while rebuilding
projections to prevent inconsistent reads and potential data corruption. For live rebuilds without downtime, rebuild
projections in separate storage and ensure new events created during the rebuild are processed after completion; this
requires careful orchestration and is beyond the scope of basic rebuilds.</p><p><strong>Separate projectors from processors.</strong> Maintain clear boundaries between event handlers that update projections and
those that trigger side effects; this separation is essential for safe rebuilds.</p><p><strong>Test rebuild logic before production.</strong> Verify your rebuild implementation works correctly on a copy of production
data before executing against live projections.</p><p><strong>Schedule rebuilds during maintenance windows.</strong> Rebuilding can be resource-intensive for large event stores; schedule
rebuilds during low-traffic periods to minimize impact.</p><p><strong>Monitor rebuild progress.</strong> For large event stores, add logging to track rebuild progress and identify potential
issues early; consider logging after every N events processed.</p><p><strong>Use selective rebuilds when possible.</strong> Rebuild only affected projections rather than all projections to save time and
resources; create temporary EventBus instances with only the necessary projectors.</p><p><strong>Consider parallel rebuilds for scale.</strong> As your event store grows, parallel rebuilds become increasingly valuable for
reducing rebuild time and resource consumption.</p><p><strong>Backup before rebuilding.</strong> Consider backing up projection data before rebuilding in case you need to roll back; this
is especially important for production systems.</p><p><strong>Keep projectors idempotent.</strong> Design projectors to produce the same result regardless of how many times events are
replayed; this ensures reliable rebuilding and recovery.</p><p><strong>Document your rebuild process.</strong> Maintain clear documentation of your rebuild procedures, including when to rebuild,
how to execute rebuilds, and expected duration for different projection sets.</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/backslash/docs/getting-started/introduction/ class="stretched-link text-reset text-decoration-none">Introduction</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/backslash/docs/testing/setting-up-tests/ class="stretched-link text-reset text-decoration-none">Setting Up Tests</a></div><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div><footer class="footer text-muted"><div class=container-lg><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item></li></ul></div></div></div></footer><script async src=/backslash/js/app.19b73e0182301dd61c9211c2f6890104740e2eb9eb12fe4ba8d4f31435b22ed6.js integrity="sha256-Gbc+AYIwHdYckhHC9okBBHQOLrnrEv5LqNTzFDWyLtY="></script><script async src=/backslash/js/flexsearch.5dd6433c29c3e043627f046054aed58ff3790f58fdb8423f45125bbafdcad335.js integrity="sha256-XdZDPCnD4ENifwRgVK7Vj/N5D1j9uEI/RRJbuv3K0zU="></script><script async src=/backslash/js/search-modal.96e662d8f691fe25c859a3437074b485f2d7bed0bca612725028c6cf4322e2f2.js integrity="sha256-luZi2PaR/iXIWaNDcHS0hfLXvtC8phJyUCjGz0Mi4vI="></script><div class="d-inline-flex fixed-bottom-right pb-4 pe-4"><button id=toTop type=button class="btn btn-primary rounded-circle ms-auto p-2"><span class=visually-hidden>Top</span><svg class="icon icon-tabler icon-tabler-chevron-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 15l6-6 6 6"/></svg></button></div></body></html>