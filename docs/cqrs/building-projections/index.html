<!doctype html><html lang=en data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://backslashphp.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://backslashphp.github.io/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://backslashphp.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><script src=/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href="/main.2c8d1a801c07c4d38f613bfa9e2c460c44b6a28e1bc6d92822d03866795a8130ad3c77c7a8f2ea47565e81d2c5b2b8cfd9c2e9c69cb47d6c31b40bad5ad98e0d.css" integrity="sha512-LI0agBwHxNOPYTv6nixGDES2oo4bxtkoItA4ZnlagTCtPHfHqPLqR1ZegdLFsrjP2cLpxpy0fWwxtAutWtmODQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://backslashphp.github.io/docs/cqrs/building-projections/><link rel=canonical href=https://backslashphp.github.io/docs/cqrs/building-projections/><title>Building Projections | Backslash PHP</title><meta name=description content="CQRS & Event Sourcing for PHP"><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:url" content="https://backslashphp.github.io/docs/cqrs/building-projections/"><meta property="og:site_name" content="Backslash PHP"><meta property="og:title" content="Building Projections"><meta property="og:description" content="Projections are read-optimized views of your system’s state. Unlike Models, which are rebuilt from events to make decisions, projections are designed specifically for querying. They represent the read side of your CQRS architecture."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="og:image" content="https://backslashphp.github.io/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://backslashphp.github.io/cover.png"><meta name=twitter:title content="Building Projections"><meta name=twitter:description content="Projections are read-optimized views of your system’s state. Unlike Models, which are rebuilt from events to make decisions, projections are designed specifically for querying. They represent the read side of your CQRS architecture."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://backslashphp.github.io/","name":"Cqrs \u0026 Event Sourcing for Php","position":1},{"@type":"ListItem","item":"https://backslashphp.github.io/docs/","name":"Documentation","position":2},{"@type":"ListItem","item":"https://backslashphp.github.io/docs/cqrs/","name":"Commands and Projections ( Cqrs)","position":3},{"@type":"ListItem","name":"Building Projections","position":4}]}</script></head><body class="single section docs" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg"><div class=container-lg><a class="navbar-brand me-auto me-lg-3" href=/>Backslash PHP</a>
<button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavSection aria-controls=offcanvasNavSection aria-label="Open section navigation menu">
<svg class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M12 5m-1 0a1 1 0 102 0 1 1 0 10-2 0"/></svg></button><div class="offcanvas offcanvas-start d-lg-none" tabindex=-1 id=offcanvasNavSection aria-labelledby=offcanvasNavSectionLabel><div class=header-bar></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavSectionLabel>Docs</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class=offcanvas-body><aside class="doks-sidebar mt-n3"><nav id=doks-docs-nav aria-label="Tertiary navigation"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details open><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/docs/getting-started/introduction/>Introduction</a></li><li><a href=/docs/getting-started/architecture-overview/>Architecture Overview</a></li><li><a href=/docs/getting-started/quick-start-guide/>Quick Start Guide</a></li></ul></details></li><li><details open><summary>Event Sourcing</summary><ul class="list-unstyled list-nested"><li><a href=/docs/event-sourcing/understanding-event-sourcing/>Understanding Event Sourcing</a></li><li><a href=/docs/event-sourcing/defining-events/>Defining Events</a></li><li><a href=/docs/event-sourcing/querying-events/>Querying Events</a></li><li><a href=/docs/event-sourcing/building-models/>Building Models</a></li></ul></details></li><li><details open open><summary>Commands and Projections (CQRS)</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cqrs/understanding-cqrs/>Understanding CQRS</a></li><li><a href=/docs/cqrs/dispatching-commands/>Dispatching Commands</a></li><li><a href=/docs/cqrs/reacting-with-event-handlers/>Reacting with Event Handlers</a></li><li class=active><a aria-current=page href=/docs/cqrs/building-projections/>Building Projections</a></li></ul></details></li><li><details open><summary>Testing Your Application</summary><ul class="list-unstyled list-nested"><li><a href=/docs/testing/setting-up-tests/>Setting Up Tests</a></li><li><a href=/docs/testing/writing-test-scenarios/>Writing Test Scenarios</a></li></ul></details></li><li><details open><summary>Customization</summary><ul class="list-unstyled list-nested"><li><a href=/docs/customization/extending-with-middleware/>Extending with Middleware</a></li><li><a href=/docs/customization/enriching-event-streams/>Enriching Event Streams</a></li></ul></details></li><li><details open><summary>Application Setup</summary><ul class="list-unstyled list-nested"><li><a href=/docs/application-setup/defining-services/>Defining Services</a></li><li><a href=/docs/application-setup/registering-handlers/>Registering Handlers</a></li><li><a href=/docs/application-setup/using-the-bootstrap-file/>Using the Bootstrap File</a></li></ul></details></li><li><details open><summary>Maintenance</summary><ul class="list-unstyled list-nested"><li><a href=/docs/maintenance/rebuilding-projections/>Rebuilding Projections</a></li></ul></details></li></ul></nav></nav></aside></div></div><button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu">
<svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class="header-bar d-lg-none"></div><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>Backslash PHP</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row justify-content-between"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://backslashphp.github.io/docs/getting-started/introduction/>Documentation</a></li><li class=nav-item><a class=nav-link href=https://github.com/backslashphp/demo>Demo</a></li><li class=nav-item><a class=nav-link href=https://backslashphp.github.io/blog/>Blog</a></li></ul><button type=button id=searchToggleDesktop class="btn btn-link nav-link p-2 d-none d-lg-block" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme">
<svg data-bs-theme-value="dark" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg>
<svg data-bs-theme-value="light" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://github.com/backslashphp/backslash><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul></div></div></div></header></div><div class=modal id=searchModal tabindex=-1 aria-labelledby=searchModalLabel aria-hidden=true><div class="modal-dialog modal-dialog-scrollable modal-fullscreen-md-down"><div class=modal-content><div class=modal-header><h1 class="modal-title fs-5 visually-hidden" id=searchModalLabel>Search</h1><button type=button class="btn-close visually-hidden" data-bs-dismiss=modal aria-label=Close></button><div class="search-input flex-grow-1 d-none"><form id=search-form class=search-form action=# method=post accept-charset=UTF-8 role=search><label for=query class=visually-hidden>Search</label><div class=d-flex><input type=search id=query name=query class="search-text form-control form-control-lg" placeholder=Search aria-label=Search maxlength=128 autocomplete=off>
<button type=button class="btn btn-link text-decoration-none px-0 ms-3 d-md-none" data-bs-dismiss=modal aria-label=Close>Cancel</button></div></form></div></div><div class=modal-body><p class="search-loading status message d-none mt-3 text-center">Loading search index…</p><p class="search-no-recent message d-none mt-3 text-center">No recent searches</p><p class="search-no-results message d-none mt-3 text-center">No results for "<strong><span class=query-no-results>Query here</span></strong>"</p><div id=searchResults class=search-results></div><template><article class="search-result list-view"><div class="card my-3"><div class=card-body><header><h2 class="h5 title title-submitted mb-0"><a class="stretched-link text-decoration-none text-reset" href=#>Title here</a></h2><div class="submitted d-none"><time class=created-date>Date here</time></div></header><div class=content>Summary here</div></div></div></article></template></div><div class=modal-footer><ul class="list-inline me-auto d-none d-md-block"><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Enter key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M12 3.53088v3c0 1-1 2-2 2H4m3 3-3-3 3-3"/></g></svg></kbd><span class=DocSearch-Label>to select</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Arrow down" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 3.5v8m3-3-3 3-3-3"/></g></svg></kbd><kbd class=me-2><svg width="15" height="15" aria-label="Arrow up" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M7.5 11.5v-8m3 3-3-3-3 3"/></g></svg></kbd><span class=DocSearch-Label>to navigate</span></li><li class=list-inline-item><kbd class=me-2><svg width="15" height="15" aria-label="Escape key" role="img"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.2"><path d="M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993.0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016s1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5s-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864.0 1.6425 1.031 1.5443 2.2492h-2.956"/></g></svg></kbd><span class=DocSearch-Label>to close</span></li></ul><p class=d-md-none>Search by <a class=text-decoration-none href=https://github.com/nextapps-de/flexsearch>FlexSearch</a></p></div></div></div></div><div class="wrap container-lg" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar docs-sidebar-offset d-none d-lg-block"><nav class="section-nav docs-links"><ul class=list-unstyled><li><details open><summary>Getting Started</summary><ul class="list-unstyled list-nested"><li><a href=/docs/getting-started/introduction/>Introduction</a></li><li><a href=/docs/getting-started/architecture-overview/>Architecture Overview</a></li><li><a href=/docs/getting-started/quick-start-guide/>Quick Start Guide</a></li></ul></details></li><li><details open><summary>Event Sourcing</summary><ul class="list-unstyled list-nested"><li><a href=/docs/event-sourcing/understanding-event-sourcing/>Understanding Event Sourcing</a></li><li><a href=/docs/event-sourcing/defining-events/>Defining Events</a></li><li><a href=/docs/event-sourcing/querying-events/>Querying Events</a></li><li><a href=/docs/event-sourcing/building-models/>Building Models</a></li></ul></details></li><li><details open open><summary>Commands and Projections (CQRS)</summary><ul class="list-unstyled list-nested"><li><a href=/docs/cqrs/understanding-cqrs/>Understanding CQRS</a></li><li><a href=/docs/cqrs/dispatching-commands/>Dispatching Commands</a></li><li><a href=/docs/cqrs/reacting-with-event-handlers/>Reacting with Event Handlers</a></li><li class=active><a aria-current=page href=/docs/cqrs/building-projections/>Building Projections</a></li></ul></details></li><li><details open><summary>Testing Your Application</summary><ul class="list-unstyled list-nested"><li><a href=/docs/testing/setting-up-tests/>Setting Up Tests</a></li><li><a href=/docs/testing/writing-test-scenarios/>Writing Test Scenarios</a></li></ul></details></li><li><details open><summary>Customization</summary><ul class="list-unstyled list-nested"><li><a href=/docs/customization/extending-with-middleware/>Extending with Middleware</a></li><li><a href=/docs/customization/enriching-event-streams/>Enriching Event Streams</a></li></ul></details></li><li><details open><summary>Application Setup</summary><ul class="list-unstyled list-nested"><li><a href=/docs/application-setup/defining-services/>Defining Services</a></li><li><a href=/docs/application-setup/registering-handlers/>Registering Handlers</a></li><li><a href=/docs/application-setup/using-the-bootstrap-file/>Using the Bootstrap File</a></li></ul></details></li><li><details open><summary>Maintenance</summary><ul class="list-unstyled list-nested"><li><a href=/docs/maintenance/rebuilding-projections/>Rebuilding Projections</a></li></ul></details></li></ul></nav></div><nav class="docs-toc docs-toc-offset d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#understanding-projections>Understanding projections</a></li><li><a href=#projections-vs-models>Projections vs Models</a></li><li><a href=#defining-projections>Defining projections</a></li><li><a href=#exposing-projection-data>Exposing projection data</a></li><li><a href=#designing-projection-structure>Designing projection structure</a></li><li><a href=#working-with-projectionstore>Working with ProjectionStore</a></li><li><a href=#setting-up-the-projectionstore>Setting up the ProjectionStore</a></li><li><a href=#committing-automatically-after-command-handling>Committing automatically after command handling</a></li><li><a href=#creating-projectors>Creating projectors</a></li><li><a href=#querying-projections>Querying projections</a></li><li><a href=#best-practices>Best practices</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Building Projections</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#understanding-projections>Understanding projections</a></li><li><a href=#projections-vs-models>Projections vs Models</a></li><li><a href=#defining-projections>Defining projections</a></li><li><a href=#exposing-projection-data>Exposing projection data</a></li><li><a href=#designing-projection-structure>Designing projection structure</a></li><li><a href=#working-with-projectionstore>Working with ProjectionStore</a></li><li><a href=#setting-up-the-projectionstore>Setting up the ProjectionStore</a></li><li><a href=#committing-automatically-after-command-handling>Committing automatically after command handling</a></li><li><a href=#creating-projectors>Creating projectors</a></li><li><a href=#querying-projections>Querying projections</a></li><li><a href=#best-practices>Best practices</a></li></ul></nav></div></details></nav><p>Projections are read-optimized views of your system&rsquo;s state. Unlike Models, which are rebuilt from events to make
decisions, projections are designed specifically for querying. They represent the read side of your CQRS architecture.</p><p><strong>Projections</strong> are data structures (read models) that represent the current state; <strong>projectors</strong> are event handlers
that update these projections when events occur. This separation keeps projection logic organized and testable.</p><p>Projections work with the <code>ProjectionStore</code>, which handles their persistence and retrieval. We&rsquo;ll cover the
<code>ProjectionStore</code> in detail later in this section.</p><h2 id=understanding-projections>Understanding projections<a href=#understanding-projections class=anchor aria-hidden=true>#</a></h2><p>A projection is a denormalized view built from events. It answers specific questions about your system&rsquo;s state without
requiring complex joins or event replay. For example:</p><ul><li>A list of all courses with their current capacity and available seats</li><li>A student&rsquo;s enrollment history with course details</li><li>A dashboard showing real-time subscription metrics</li></ul><p>Projections are updated synchronously after events are published. Because event handlers execute in the same PHP process
as command dispatch, projections are immediately consistent with the write side once the command completes.</p><p>Projections are often designed for specific UI needs. They can expose their data in convenient formats like arrays for
JSON serialization or XML objects for API responses. This flexibility allows you to tailor each projection to its
intended consumer.</p><h2 id=projections-vs-models>Projections vs Models<a href=#projections-vs-models class=anchor aria-hidden=true>#</a></h2><p>The distinction between projections and models is fundamental to CQRS:</p><p><strong>Models (write side):</strong></p><ul><li>Rebuilt from events for each decision</li><li>Enforce business rules</li><li>Not persisted; exist only during command processing</li><li>Optimized for making decisions</li></ul><p><strong>Projections (read side):</strong></p><ul><li>Continuously updated as events occur</li><li>Persisted for efficient querying</li><li>No business logic; simple data structures</li><li>Optimized for reading and display</li></ul><h2 id=defining-projections>Defining projections<a href=#defining-projections class=anchor aria-hidden=true>#</a></h2><p>Projections must implement <code>ProjectionInterface</code>:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>interface</span> <span class=nx>ProjectionInterface</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getId</span><span class=p>()</span><span class=o>:</span> <span class=nx>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></figure></div><p>The <code>getId()</code> method returns the projection&rsquo;s identifier. A projection&rsquo;s identity is composed of both its ID and its
fully qualified class name, which means two different projection classes can use the same ID without conflict.</p><p>Here&rsquo;s a simple projection example:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>CourseProjection</span> <span class=k>implements</span> <span class=nx>ProjectionInterface</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nx>string</span> <span class=nv>$courseId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nx>string</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nx>int</span> <span class=nv>$capacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$courseId</span><span class=p>,</span> <span class=nx>string</span> <span class=nv>$name</span><span class=p>,</span> <span class=nx>int</span> <span class=nv>$capacity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>courseId</span> <span class=o>=</span> <span class=nv>$courseId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span> <span class=o>=</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>capacity</span> <span class=o>=</span> <span class=nv>$capacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getId</span><span class=p>()</span><span class=o>:</span> <span class=nx>string</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>courseId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getName</span><span class=p>()</span><span class=o>:</span> <span class=nx>string</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getCapacity</span><span class=p>()</span><span class=o>:</span> <span class=nx>int</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>capacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>changeCapacity</span><span class=p>(</span><span class=nx>int</span> <span class=nv>$newCapacity</span><span class=p>)</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>capacity</span> <span class=o>=</span> <span class=nv>$newCapacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></figure></div><p>This projection represents a course with methods to access its data and update its capacity. Each course gets its own
projection instance identified by its course ID.</p><h2 id=exposing-projection-data>Exposing projection data<a href=#exposing-projection-data class=anchor aria-hidden=true>#</a></h2><p>Projections often need to expose their data in formats suitable for APIs or user interfaces. Implement
<code>JsonSerializable</code> to control JSON representation:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>CourseProjection</span> <span class=k>implements</span> <span class=nx>ProjectionInterface</span><span class=p>,</span> <span class=nx>JsonSerializable</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nx>string</span> <span class=nv>$courseId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nx>string</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nx>int</span> <span class=nv>$capacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>string</span> <span class=nv>$courseId</span><span class=p>,</span> <span class=nx>string</span> <span class=nv>$name</span><span class=p>,</span> <span class=nx>int</span> <span class=nv>$capacity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>courseId</span> <span class=o>=</span> <span class=nv>$courseId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span> <span class=o>=</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>capacity</span> <span class=o>=</span> <span class=nv>$capacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getId</span><span class=p>()</span><span class=o>:</span> <span class=nx>string</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>courseId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getName</span><span class=p>()</span><span class=o>:</span> <span class=nx>string</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getCapacity</span><span class=p>()</span><span class=o>:</span> <span class=nx>int</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>capacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>changeCapacity</span><span class=p>(</span><span class=nx>int</span> <span class=nv>$newCapacity</span><span class=p>)</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>capacity</span> <span class=o>=</span> <span class=nv>$newCapacity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>jsonSerialize</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>courseId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;capacity&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>capacity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></figure></div><p>This allows seamless JSON encoding:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$projection</span> <span class=o>=</span> <span class=nv>$projectionStore</span><span class=o>-&gt;</span><span class=na>find</span><span class=p>(</span><span class=s1>&#39;course-123&#39;</span><span class=p>,</span> <span class=nx>CourseProjection</span><span class=o>::</span><span class=na>class</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$json</span> <span class=o>=</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$projection</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// {&#34;id&#34;:&#34;course-123&#34;,&#34;name&#34;:&#34;PHP Basics&#34;,&#34;capacity&#34;:30}
</span></span></span></code></pre></div></figure></div><p>Similarly, projections can provide methods for XML, CSV, or any other format your application needs:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>toXml</span><span class=p>()</span><span class=o>:</span> <span class=nx>SimpleXMLElement</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$xml</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>SimpleXMLElement</span><span class=p>(</span><span class=s1>&#39;&lt;course/&gt;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$xml</span><span class=o>-&gt;</span><span class=na>addChild</span><span class=p>(</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>courseId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$xml</span><span class=o>-&gt;</span><span class=na>addChild</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$xml</span><span class=o>-&gt;</span><span class=na>addChild</span><span class=p>(</span><span class=s1>&#39;capacity&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>string</span><span class=p>)</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>capacity</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$xml</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>toArray</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;id&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>courseId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;capacity&#39;</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>capacity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></figure></div><h2 id=designing-projection-structure>Designing projection structure<a href=#designing-projection-structure class=anchor aria-hidden=true>#</a></h2><p>Design your projections based on how you need to query them, not how your domain is modeled. A single domain concept
might have multiple projections for different use cases.</p><p>Multiple specialized projections may seem redundant, but they enable optimal query performance; each projection can be
indexed and structured for its specific access pattern.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// For listing all courses
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>CourseListItemProjection</span> <span class=k>implements</span> <span class=nx>ProjectionInterface</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>string</span> <span class=nv>$id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>string</span> <span class=nv>$name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>int</span> <span class=nv>$availableSeats</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getId</span><span class=p>()</span><span class=o>:</span> <span class=nx>string</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// For displaying course details
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>CourseDetailProjection</span> <span class=k>implements</span> <span class=nx>ProjectionInterface</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>string</span> <span class=nv>$id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>string</span> <span class=nv>$name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>string</span> <span class=nv>$description</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>int</span> <span class=nv>$capacity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>int</span> <span class=nv>$subscribedCount</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>array</span> <span class=nv>$subscribedStudents</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getId</span><span class=p>()</span><span class=o>:</span> <span class=nx>string</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// For analytics
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>CourseMetricsProjection</span> <span class=k>implements</span> <span class=nx>ProjectionInterface</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>string</span> <span class=nv>$id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>int</span> <span class=nv>$totalSubscriptions</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>int</span> <span class=nv>$totalUnsubscriptions</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nx>float</span> <span class=nv>$averageSubscriptionDuration</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getId</span><span class=p>()</span><span class=o>:</span> <span class=nx>string</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></figure></div><p>Each projection is tailored to answer specific queries efficiently.</p><h2 id=working-with-projectionstore>Working with ProjectionStore<a href=#working-with-projectionstore class=anchor aria-hidden=true>#</a></h2><p>The <code>ProjectionStore</code> is responsible for persisting and retrieving projections. It uses an adapter to interact with the
underlying storage mechanism.</p><p>Backslash provides two built-in adapters:</p><ul><li><strong>PdoProjectionStoreAdapter</strong>: For PDO-compatible databases (MySQL, SQLite); suitable for production use</li><li><strong>InMemoryProjectionStoreAdapter</strong>: In-memory storage; useful for testing with the <code>Scenario</code> component</li></ul><p>Developers can build custom adapters for other storage engines like MongoDB, Redis, or even a file system by
implementing the <code>AdapterInterface</code>.</p><h2 id=setting-up-the-projectionstore>Setting up the ProjectionStore<a href=#setting-up-the-projectionstore class=anchor aria-hidden=true>#</a></h2><p>Create a <code>ProjectionStore</code> instance with a storage adapter during your application&rsquo;s bootstrap:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$pdo</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PdoProxy</span><span class=p>(</span><span class=nx>fn</span><span class=p>()</span> <span class=o>=&gt;</span> <span class=k>new</span> <span class=nx>PDO</span><span class=p>(</span><span class=s1>&#39;mysql:host=localhost;dbname=myapp&#39;</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;pass&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nv>$serializer</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Serializer</span><span class=p>(</span><span class=k>new</span> <span class=nx>SerializeFunctionSerializer</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nv>$config</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Config</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$adapter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PdoProjectionStoreAdapter</span><span class=p>(</span><span class=nv>$pdo</span><span class=p>,</span> <span class=nv>$serializer</span><span class=p>,</span> <span class=nv>$config</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$projectionStore</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ProjectionStore</span><span class=p>(</span><span class=nv>$adapter</span><span class=p>);</span></span></span></code></pre></div></figure></div><p>The <code>PdoProjectionStoreAdapter</code> requires:</p><ul><li><strong>PDO connection</strong>: Database connection via <code>PdoProxy</code> or direct <code>PDO</code> instance</li><li><strong>Serializer</strong>: Converts projections to/from storage format; <code>SerializeFunctionSerializer</code> uses PHP&rsquo;s native
<code>serialize()</code> function</li><li><strong>Config</strong> (optional): Allows customization of database column names via <code>withTable()</code> and <code>withAlias()</code> methods</li></ul><p>Example with custom configuration:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$config</span> <span class=o>=</span> <span class=p>(</span><span class=k>new</span> <span class=nx>Config</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>withTable</span><span class=p>(</span><span class=s1>&#39;my_projections&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>withAlias</span><span class=p>(</span><span class=s1>&#39;projection_id&#39;</span><span class=p>,</span> <span class=s1>&#39;id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>withAlias</span><span class=p>(</span><span class=s1>&#39;projection_class&#39;</span><span class=p>,</span> <span class=s1>&#39;type&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>withAlias</span><span class=p>(</span><span class=s1>&#39;projection_payload&#39;</span><span class=p>,</span> <span class=s1>&#39;data&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$adapter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PdoProjectionStoreAdapter</span><span class=p>(</span><span class=nv>$pdo</span><span class=p>,</span> <span class=nv>$serializer</span><span class=p>,</span> <span class=nv>$config</span><span class=p>);</span></span></span></code></pre></div></figure></div><p>For testing, use the <code>InMemoryProjectionStoreAdapter</code>:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$adapter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>InMemoryProjectionStoreAdapter</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$projectionStore</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ProjectionStore</span><span class=p>(</span><span class=nv>$adapter</span><span class=p>);</span></span></span></code></pre></div></figure></div><p>This adapter stores projections in memory, making it fast and isolated for test scenarios.</p><h2 id=committing-automatically-after-command-handling>Committing automatically after command handling<a href=#committing-automatically-after-command-handling class=anchor aria-hidden=true>#</a></h2><p>Backslash provides <code>ProjectionStoreTransactionCommandDispatcherMiddleware</code>, a command dispatcher middleware that manages
projection transactions automatically. It wraps the command dispatch process in a transaction and calls <code>commit()</code> on
the <code>ProjectionStore</code> when the command completes successfully. If an exception occurs during command processing, the
middleware calls <code>rollback()</code> to discard buffered changes.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>Backslash\ProjectionStoreTransactionCommandDispatcherMiddleware\ProjectionStoreTransactionCommandDispatcherMiddleware</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$dispatcher</span><span class=o>-&gt;</span><span class=na>addMiddleware</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=nx>ProjectionStoreTransactionCommandDispatcherMiddleware</span><span class=p>(</span><span class=nv>$projectionStore</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>);</span></span></span></code></pre></div></figure></div><p>This middleware is typically added to the command dispatcher during application bootstrap, ensuring all commands benefit
from automatic transaction management without requiring explicit commit/rollback calls in command handlers.</p><h2 id=creating-projectors>Creating projectors<a href=#creating-projectors class=anchor aria-hidden=true>#</a></h2><p>Projectors are event handlers that update projections. Here&rsquo;s a complete example:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>CourseProjector</span> <span class=k>implements</span> <span class=nx>EventHandlerInterface</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nx>EventHandlerTrait</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=nx>ProjectionStoreInterface</span> <span class=nv>$projections</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>function</span> <span class=nf>handleCourseDefinedEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>CourseDefinedEvent</span> <span class=nv>$event</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>RecordedEvent</span> <span class=nv>$recordedEvent</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span><span class=o>:</span> <span class=nx>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$projection</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CourseProjection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nv>$event</span><span class=o>-&gt;</span><span class=na>courseId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$event</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nv>$event</span><span class=o>-&gt;</span><span class=na>capacity</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>projections</span><span class=o>-&gt;</span><span class=na>store</span><span class=p>(</span><span class=nv>$projection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>function</span> <span class=nf>handleCourseCapacityChangedEvent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>CourseCapacityChangedEvent</span> <span class=nv>$event</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>RecordedEvent</span> <span class=nv>$recordedEvent</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span><span class=o>:</span> <span class=nx>void</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$projection</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>projections</span><span class=o>-&gt;</span><span class=na>find</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nv>$event</span><span class=o>-&gt;</span><span class=na>courseId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>CourseProjection</span><span class=o>::</span><span class=na>class</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nv>$projection</span><span class=o>-&gt;</span><span class=na>changeCapacity</span><span class=p>(</span><span class=nv>$event</span><span class=o>-&gt;</span><span class=na>new</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>projections</span><span class=o>-&gt;</span><span class=na>store</span><span class=p>(</span><span class=nv>$projection</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>ProjectionNotFoundException</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Log or handle missing projection
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></figure></div><p>Register the projector with the EventBus:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$projector</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CourseProjector</span><span class=p>(</span><span class=nv>$projectionStore</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nx>CourseDefinedEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$projector</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$eventBus</span><span class=o>-&gt;</span><span class=na>subscribe</span><span class=p>(</span><span class=nx>CourseCapacityChangedEvent</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nv>$projector</span><span class=p>);</span></span></span></code></pre></div></figure></div><h2 id=querying-projections>Querying projections<a href=#querying-projections class=anchor aria-hidden=true>#</a></h2><p>Once projections are persisted, you can query them in your application or UI layer:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// In a request handler or controller
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>(</span><span class=nx>ServerRequestInterface</span> <span class=nv>$request</span><span class=p>)</span><span class=o>:</span> <span class=nx>ResponseInterface</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$courseId</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>getAttribute</span><span class=p>(</span><span class=s1>&#39;courseId&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$projection</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>projectionStore</span><span class=o>-&gt;</span><span class=na>find</span><span class=p>(</span><span class=nv>$courseId</span><span class=p>,</span> <span class=nx>CourseProjection</span><span class=o>::</span><span class=na>class</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nx>JsonResponse</span><span class=p>(</span><span class=nv>$projection</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></figure></div><p>This separation between write operations (commands updating models) and read operations (queries fetching projections)
is the essence of CQRS.</p><h2 id=best-practices>Best practices<a href=#best-practices class=anchor aria-hidden=true>#</a></h2><p><strong>Design for queries.</strong> Structure projections based on how you need to query them, not how your domain is modeled.</p><p><strong>Create multiple projections.</strong> Don&rsquo;t try to create one projection that serves all queries. Build specialized
projections for different use cases.</p><p><strong>Use buffering for consistency.</strong> The buffering mechanism enables batch updates and transactional consistency. Use
middleware to manage commit/rollback automatically.</p><p><strong>Keep projections simple.</strong> Projections should be dumb data structures. Complex logic belongs in the projectors that
update them.</p><p><strong>Keep projectors autonomous.</strong> Projectors should only read and modify the projections they own; avoid reading other
projections. If you need data from multiple projections, create a new combined projection instead.</p><p><strong>Optimize for reads.</strong> Precompute values, denormalize data, and structure projections to make queries fast.</p><p><strong>One projection instance per entity.</strong> Each entity (course, student, etc.) should have its own projection instance with
a unique ID.</p><p><strong>Make projections serializable.</strong> Projections must be serializable for persistence. Use simple types and avoid circular
references.</p><hr><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card w-100"><div class="card-body d-flex"><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-left" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M5 12l6 6"/><path d="M5 12l6-6"/></svg></div><div class="d-flex flex-column"><div class=text-body-secondary>Prev</div><a href=/docs/application-setup/using-the-bootstrap-file/ class="stretched-link text-reset text-decoration-none">Using the Bootstrap File</a></div></div></div><div class=m-2></div><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/docs/event-sourcing/defining-events/ class="stretched-link text-reset text-decoration-none">Defining Events</a></div><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div><footer class="footer text-muted"><div class=container-lg><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item></li></ul></div></div></div></footer><script async src=/js/app.19b73e0182301dd61c9211c2f6890104740e2eb9eb12fe4ba8d4f31435b22ed6.js integrity="sha256-Gbc+AYIwHdYckhHC9okBBHQOLrnrEv5LqNTzFDWyLtY="></script><script async src=/js/flexsearch.5dd6433c29c3e043627f046054aed58ff3790f58fdb8423f45125bbafdcad335.js integrity="sha256-XdZDPCnD4ENifwRgVK7Vj/N5D1j9uEI/RRJbuv3K0zU="></script><script async src=/js/search-modal.96e662d8f691fe25c859a3437074b485f2d7bed0bca612725028c6cf4322e2f2.js integrity="sha256-luZi2PaR/iXIWaNDcHS0hfLXvtC8phJyUCjGz0Mi4vI="></script><div class="d-inline-flex fixed-bottom-right pb-4 pe-4"><button id=toTop type=button class="btn btn-primary rounded-circle ms-auto p-2"><span class=visually-hidden>Top</span><svg class="icon icon-tabler icon-tabler-chevron-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 15l6-6 6 6"/></svg></button></div></body></html>