<!doctype html><html lang=en-ca dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Writing Test Scenarios#
The Scenario component provides a fluent, behavior-driven interface for testing event-sourced applications. It uses
the Play class to define test scenarios in a readable, expressive manner.
Understanding scenarios#
Scenarios test the complete flow from command dispatch through event publication to projection updates. They verify that
commands produce the expected events and that projections are updated correctly.
The Scenario class was instantiated in your base test case (section 12). Each test creates Play instances and
executes them via scenario->play()."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://backslashphp.github.io/backslash/testing/writing-test-scenarios/"><meta property="og:site_name" content="Backslash PHP Developer Guide"><meta property="og:title" content="Writing Test Scenarios"><meta property="og:description" content="Writing Test Scenarios# The Scenario component provides a fluent, behavior-driven interface for testing event-sourced applications. It uses the Play class to define test scenarios in a readable, expressive manner.
Understanding scenarios# Scenarios test the complete flow from command dispatch through event publication to projection updates. They verify that commands produce the expected events and that projections are updated correctly.
The Scenario class was instantiated in your base test case (section 12). Each test creates Play instances and executes them via scenario->play()."><meta property="og:locale" content="en_ca"><meta property="og:type" content="article"><meta property="article:section" content="testing"><meta property="article:modified_time" content="2025-11-11T17:09:05-05:00"><title>Writing Test Scenarios | Backslash PHP Developer Guide</title><link rel=icon href=/backslash/favicon.png><link rel=manifest href=/backslash/manifest.json><link rel=canonical href=https://backslashphp.github.io/backslash/testing/writing-test-scenarios/><link rel=stylesheet href=/backslash/book.min.c0e41de750417a94c4724981669dbe7955cfa422e1b2a84d4d2ac5e7d4a300f2.css integrity="sha256-wOQd51BBepTEckmBZp2+eVXPpCLhsqhNTSrF59SjAPI=" crossorigin=anonymous><script defer src=/backslash/fuse.min.js></script><script defer src=/backslash/en.search.min.bf5cf25dfd21948ac026e92ebfbb526af7dc35e848feb1e5549f4f2ff0904a2c.js integrity="sha256-v1zyXf0hlIrAJukuv7tSavfcNehI/rHlVJ9PL/CQSiw=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-testing"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/backslash/><span>Backslash PHP Developer Guide</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=https://github.com/backslashphp/backslash target=_blank rel=noopener>Source code</a></li><li><a href=https://github.com/backslashphp/demo target=_blank rel=noopener>Demo application</a></li></ul><ul><li class=book-section-flat><a>Getting Started</a><ul><li><a href=/backslash/getting-started/introduction/>Introduction</a></li><li><a href=/backslash/getting-started/architecture-overview/>Architecture Overview</a></li><li><a href=/backslash/getting-started/quick-start-guide/>Quick Start Guide</a></li></ul></li><li class=book-section-flat><a>Event Sourcing</a><ul><li><a href=/backslash/event-sourcing/understanding-event-sourcing/>Understanding Event Sourcing</a></li><li><a href=/backslash/event-sourcing/defining-events/>Defining Events</a></li><li><a href=/backslash/event-sourcing/querying-events/>Querying Events</a></li><li><a href=/backslash/event-sourcing/building-models/>Building Models</a></li></ul></li><li class=book-section-flat><a>Commands and Projections (CQRS)</a><ul><li><a href=/backslash/cqrs/understanding-cqrs/>Understanding CQRS</a></li><li><a href=/backslash/cqrs/dispatching-commands/>Dispatching Commands</a></li><li><a href=/backslash/cqrs/reacting-with-event-handlers/>Reacting with Event Handlers</a></li><li><a href=/backslash/cqrs/building-projections/>Building Projections</a></li></ul></li><li class=book-section-flat><a>Testing Your Application</a><ul><li><a href=/backslash/testing/setting-up-tests/>Setting Up Tests</a></li><li><a href=/backslash/testing/writing-test-scenarios/ class=active>Writing Test Scenarios</a></li></ul></li><li class=book-section-flat><a>Customization</a><ul><li><a href=/backslash/customization/extending-with-middleware/>Extending with Middleware</a></li><li><a href=/backslash/customization/enriching-event-streams/>Enriching Event Streams</a></li></ul></li><li class=book-section-flat><a>Application Setup</a><ul><li><a href=/backslash/application-setup/defining-services/>Defining Services</a></li><li><a href=/backslash/application-setup/registering-handlers/>Registering Handlers</a></li><li><a href=/backslash/application-setup/using-the-bootstrap-file/>Using the Bootstrap File</a></li></ul></li><li class=book-section-flat><a>Maintenance</a><ul><li><a href=/backslash/maintenance/rebuilding-projections/>Rebuilding Projections</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/backslash/icons/menu.svg class=book-icon alt=Menu></label><h3>Writing Test Scenarios</h3><label for=toc-control><img src=/backslash/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#understanding-scenarios>Understanding scenarios</a></li><li><a href=#writing-basic-scenarios-with-play>Writing basic scenarios with Play</a></li><li><a href=#setting-up-initial-state>Setting up initial state</a></li><li><a href=#dispatching-commands>Dispatching commands</a></li><li><a href=#executing-actions>Executing actions</a></li><li><a href=#asserting-on-published-events>Asserting on published events</a></li><li><a href=#asserting-on-updated-projections>Asserting on updated projections</a></li><li><a href=#custom-assertions>Custom assertions</a></li><li><a href=#testing-business-rule-violations>Testing business rule violations</a></li><li><a href=#chaining-multiple-plays>Chaining multiple plays</a></li><li><a href=#complete-scenario-example>Complete scenario example</a></li><li><a href=#using-assertionstrait>Using AssertionsTrait</a></li><li><a href=#chaining-play-methods>Chaining Play methods</a></li><li><a href=#testing-models-in-isolation>Testing models in isolation</a></li><li><a href=#best-practices>Best practices</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=writing-test-scenarios>Writing Test Scenarios<a class=anchor href=#writing-test-scenarios>#</a></h1><p>The <code>Scenario</code> component provides a fluent, behavior-driven interface for testing event-sourced applications. It uses
the <code>Play</code> class to define test scenarios in a readable, expressive manner.</p><h2 id=understanding-scenarios>Understanding scenarios<a class=anchor href=#understanding-scenarios>#</a></h2><p>Scenarios test the complete flow from command dispatch through event publication to projection updates. They verify that
commands produce the expected events and that projections are updated correctly.</p><p>The <code>Scenario</code> class was instantiated in your base test case (section 12). Each test creates <code>Play</code> instances and
executes them via <code>scenario->play()</code>.</p><p>A scenario can execute multiple plays sequentially, similar to acts in a theater piece. Each play represents a distinct
phase of the test, and subsequent plays see the effects of previous plays.</p><h2 id=writing-basic-scenarios-with-play>Writing basic scenarios with Play<a class=anchor href=#writing-basic-scenarios-with-play>#</a></h2><p>Create test scenarios using the <code>Play</code> class. A Play defines:</p><ul><li><strong>Initial state</strong> via <code>withInitialEvents()</code> or <code>withInitialCommands()</code></li><li><strong>Actions</strong> via <code>dispatch()</code> or <code>doAction()</code></li><li><strong>Assertions</strong> via <code>testEvents()</code>, <code>testProjections()</code>, or <code>testThat()</code></li><li><strong>Expected exceptions</strong> via <code>expectException()</code> or <code>expectExceptionMessage()</code></li></ul><p>The order of these methods matters: setup methods should come first, followed by actions, then assertions.</p><p>Here&rsquo;s a basic example:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test_registering_student_publishes_event</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;John&#39;</span>))
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testEvents</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>PublishedEvents</span> $events) {
</span></span><span style=display:flex><span>                $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContainExactly</span>([
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>StudentRegisteredEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                ], $events);
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div><h2 id=setting-up-initial-state>Setting up initial state<a class=anchor href=#setting-up-initial-state>#</a></h2><p>Use <code>withInitialCommands()</code> to establish state by dispatching commands before the test action:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>withInitialCommands</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DefineCourseCommand</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#e6db74>&#39;PHP Basics&#39;</span>, <span style=color:#ae81ff>10</span>),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;Alice&#39;</span>)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SubscribeStudentToCourseCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;123&#39;</span>))
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testEvents</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>PublishedEvents</span> $events) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContain</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>StudentSubscribedToCourseEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>,
</span></span><span style=display:flex><span>                $events
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>);</span></span></code></pre></td></tr></table></div></div><p>Commands passed to <code>withInitialCommands()</code> are dispatched before the main test action, setting up the required initial
state.</p><p>Use <code>withInitialEvents()</code> to directly publish events for initial state:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Backslash\Event\RecordedEventStream</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$initialEvents <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RecordedEventStream</span>([
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RecordedEvent</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CourseDefinedEvent</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#e6db74>&#39;PHP Basics&#39;</span>, <span style=color:#ae81ff>10</span>),
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Metadata</span>([]),
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DateTimeImmutable</span>()
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>withInitialEvents</span>($initialEvents)
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ChangeCourseCapacityCommand</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#ae81ff>20</span>))
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testEvents</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>PublishedEvents</span> $events) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContain</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>CourseCapacityChangedEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>,
</span></span><span style=display:flex><span>                $events
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>);</span></span></code></pre></td></tr></table></div></div><h2 id=dispatching-commands>Dispatching commands<a class=anchor href=#dispatching-commands>#</a></h2><p>Use <code>dispatch()</code> to execute one or more commands:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;John&#39;</span>),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;2&#39;</span>, <span style=color:#e6db74>&#39;Alice&#39;</span>)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testEvents</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>PublishedEvents</span> $events) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsCount</span>(<span style=color:#ae81ff>2</span>, $events);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>);</span></span></code></pre></td></tr></table></div></div><p>Commands are dispatched through the normal command handling flow, including all middleware and handlers.</p><h2 id=executing-actions>Executing actions<a class=anchor href=#executing-actions>#</a></h2><p>Use <code>doAction()</code> to execute arbitrary code during the test. Common use cases include:</p><ul><li>Defining constants or variables needed by subsequent assertions</li><li>Setting up mocks or stubs</li><li>Manipulating time or other external dependencies</li></ul><p>Example:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>withInitialCommands</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DefineCourseCommand</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#e6db74>&#39;PHP Basics&#39;</span>, <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>doAction</span>(<span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Define a constant for use in later assertions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;MY_CONSTANT&#39;</span>, <span style=color:#e6db74>&#39;some-value&#39;</span>);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ChangeCourseCapacityCommand</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#ae81ff>20</span>))
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testEvents</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>PublishedEvents</span> $events) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsCount</span>(<span style=color:#ae81ff>1</span>, $events);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testThat</span>(<span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Verify the constant was defined
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertTrue</span>(<span style=color:#a6e22e>defined</span>(<span style=color:#e6db74>&#39;MY_CONSTANT&#39;</span>));
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>);</span></span></code></pre></td></tr></table></div></div><p>Actions execute in the order they&rsquo;re defined relative to commands.</p><h2 id=asserting-on-published-events>Asserting on published events<a class=anchor href=#asserting-on-published-events>#</a></h2><p>Use <code>testEvents()</code> to verify which events were published:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;John&#39;</span>))
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testEvents</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>PublishedEvents</span> $events) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Assert specific event was published
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContain</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>StudentRegisteredEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>,
</span></span><span style=display:flex><span>                $events
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Assert event count
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsCount</span>(<span style=color:#ae81ff>1</span>, $events);
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Assert exact event types and counts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContainExactly</span>([
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>StudentRegisteredEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>            ], $events);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>);</span></span></code></pre></td></tr></table></div></div><p>The <code>testEvents()</code> callback receives a <code>PublishedEvents</code> object containing all events published **during this play only
**. Events from previous plays or initial setup are not included in this collection.</p><h2 id=asserting-on-updated-projections>Asserting on updated projections<a class=anchor href=#asserting-on-updated-projections>#</a></h2><p>Use <code>testProjections()</code> to verify which projections were updated:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>withInitialCommands</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DefineCourseCommand</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#e6db74>&#39;PHP Basics&#39;</span>, <span style=color:#ae81ff>10</span>),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;John&#39;</span>)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SubscribeStudentToCourseCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;123&#39;</span>))
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testProjections</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>UpdatedProjections</span> $projections) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Assert specific projection was updated
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertUpdatedProjectionsContain</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>StudentListProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>,
</span></span><span style=display:flex><span>                $projections
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Access updated projections
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            $studentList <span style=color:#f92672>=</span> $projections<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getAllOf</span>(<span style=color:#a6e22e>StudentListProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertStringContainsString</span>(<span style=color:#e6db74>&#39;John (PHP Basics)&#39;</span>, (<span style=color:#a6e22e>string</span>) $studentList);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>);</span></span></code></pre></td></tr></table></div></div><p>The <code>testProjections()</code> callback receives an <code>UpdatedProjections</code> object containing projections modified <strong>during this
play only</strong>. Projections updated in previous plays are not included.</p><p>Use <code>getAllOf()</code> to retrieve all updated projections of a specific type. This returns an array because multiple
projection instances of the same class can be updated in a single play (for example, updating both <code>CourseProjection</code>
for course-123 and <code>CourseProjection</code> for course-456). Access individual projections by array index.</p><h2 id=custom-assertions>Custom assertions<a class=anchor href=#custom-assertions>#</a></h2><p>Use <code>testThat()</code> for custom assertion logic:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;John&#39;</span>))
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testThat</span>(<span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>            $projection <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>projectionStore</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>find</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>StudentListProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>ID</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>StudentListProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertStringContainsString</span>(<span style=color:#e6db74>&#39;John&#39;</span>, (<span style=color:#a6e22e>string</span>) $projection);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>);</span></span></code></pre></td></tr></table></div></div><p>The <code>testThat()</code> callback executes after commands and actions, allowing arbitrary assertions.</p><h2 id=testing-business-rule-violations>Testing business rule violations<a class=anchor href=#testing-business-rule-violations>#</a></h2><p>Test that commands throw exceptions using <code>expectException()</code>:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test_cannot_subscribe_to_full_course</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>expectException</span>(<span style=color:#a6e22e>CourseAtFullCapacityException</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>withInitialCommands</span>(
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DefineCourseCommand</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#e6db74>&#39;PHP Basics&#39;</span>, <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;John&#39;</span>),
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;2&#39;</span>, <span style=color:#e6db74>&#39;Alice&#39;</span>),
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SubscribeStudentToCourseCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;123&#39;</span>)
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SubscribeStudentToCourseCommand</span>(<span style=color:#e6db74>&#39;2&#39;</span>, <span style=color:#e6db74>&#39;123&#39;</span>))
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div><p>When <code>expectException()</code> is used, the test passes only if the expected exception is thrown. Use the
<code>@doesNotPerformAssertions</code> PHPUnit annotation to avoid warnings; PHPUnit expects at least one assertion per test, but
with <code>expectException()</code> alone, PHPUnit doesn&rsquo;t recognize it as an assertion, so the annotation tells PHPUnit this is
intentional.</p><p>Test for specific exception messages using <code>expectExceptionMessage()</code>:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>expectExceptionMessage</span>(<span style=color:#e6db74>&#39;Course is at full capacity&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>withInitialCommands</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DefineCourseCommand</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#e6db74>&#39;PHP Basics&#39;</span>, <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;John&#39;</span>),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;2&#39;</span>, <span style=color:#e6db74>&#39;Alice&#39;</span>),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SubscribeStudentToCourseCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;123&#39;</span>)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SubscribeStudentToCourseCommand</span>(<span style=color:#e6db74>&#39;2&#39;</span>, <span style=color:#e6db74>&#39;123&#39;</span>))
</span></span><span style=display:flex><span>);</span></span></code></pre></td></tr></table></div></div><h2 id=chaining-multiple-plays>Chaining multiple plays<a class=anchor href=#chaining-multiple-plays>#</a></h2><p>A scenario can execute multiple plays sequentially, like acts in a theater piece. Each play represents a distinct phase
of the test:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test_subscription_lifecycle</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $subscribe <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>withInitialCommands</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DefineCourseCommand</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#e6db74>&#39;PHP Basics&#39;</span>, <span style=color:#ae81ff>10</span>),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;John&#39;</span>)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SubscribeStudentToCourseCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;123&#39;</span>))
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testEvents</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>PublishedEvents</span> $events) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContain</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>StudentSubscribedToCourseEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>,
</span></span><span style=display:flex><span>                $events
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $unsubscribe <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UnsubscribeStudentFromCourseCommand</span>(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;123&#39;</span>))
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testEvents</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>PublishedEvents</span> $events) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContain</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>StudentUnsubscribedFromCourseEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>,
</span></span><span style=display:flex><span>                $events
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>($subscribe, $unsubscribe);
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div><p>Each play executes in order, like acts in a theater piece. The second play (unsubscribe) sees all the effects of the
first play (subscribe), including published events and updated projections. This allows you to test multi-step workflows
while keeping each phase clearly defined and testable.</p><h2 id=complete-scenario-example>Complete scenario example<a class=anchor href=#complete-scenario-example>#</a></h2><p>Here&rsquo;s a comprehensive example demonstrating all Play features and assertions:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test_subscription_workflow</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $studentId <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;1&#39;</span>;
</span></span><span style=display:flex><span>    $courseId <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;2&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $subscribe <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>withInitialEvents</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RecordedEventStream</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>RecordedEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>create</span>(
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CourseDefinedEvent</span>($courseId, <span style=color:#e6db74>&#39;Maths&#39;</span>, <span style=color:#ae81ff>30</span>),
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Metadata</span>(),
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DateTimeImmutable</span>(),
</span></span><span style=display:flex><span>                ),
</span></span><span style=display:flex><span>            ),
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>withInitialCommands</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RegisterStudentCommand</span>($studentId, <span style=color:#e6db74>&#39;John&#39;</span>),
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SubscribeStudentToCourseCommand</span>($studentId, $courseId),
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>doAction</span>(<span style=color:#66d9ef>function</span> ()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;MY_CONSTANT&#39;</span>, <span style=color:#e6db74>&#39;some-value&#39;</span>);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testEvents</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>PublishedEvents</span> $events) <span style=color:#66d9ef>use</span> ($studentId, $courseId)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsCount</span>(<span style=color:#ae81ff>1</span>, $events);
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContainOnly</span>(<span style=color:#a6e22e>StudentSubscribedToCourseEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, $events);
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsDoNotContain</span>(<span style=color:#a6e22e>StudentUnsubscribedFromCourseEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, $events);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>/** @var StudentSubscribedToCourseEvent $event */</span>
</span></span><span style=display:flex><span>            $event <span style=color:#f92672>=</span> $events<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getAllOf</span>(<span style=color:#a6e22e>StudentSubscribedToCourseEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getEvent</span>();
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertEquals</span>($studentId, $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>studentId</span>);
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertEquals</span>($courseId, $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>courseId</span>);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testProjections</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>UpdatedProjections</span> $projections)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertUpdatedProjectionsCount</span>(<span style=color:#ae81ff>2</span>, $projections);
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertUpdatedProjectionsContainExactly</span>([
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>CourseListProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>StudentListProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>            ], $projections);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testThat</span>(<span style=color:#66d9ef>function</span> ()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>defined</span>(<span style=color:#e6db74>&#39;MY_CONSTANT&#39;</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $unsubscribe <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UnsubscribeStudentFromCourseCommand</span>($studentId, $courseId),
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testEvents</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>PublishedEvents</span> $events) <span style=color:#66d9ef>use</span> ($studentId, $courseId)<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span> {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContainExactly</span>([
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>StudentUnsubscribedFromCourseEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>            ], $events);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $oops <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>expectException</span>(<span style=color:#a6e22e>StudentNotSubscribedToCourseException</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>UnsubscribeStudentFromCourseCommand</span>($studentId, $courseId),
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>        $subscribe,
</span></span><span style=display:flex><span>        $unsubscribe,
</span></span><span style=display:flex><span>        $oops,
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div><p>This example demonstrates:</p><ul><li><strong>withInitialEvents()</strong>: Setting up state with a <code>RecordedEventStream</code></li><li><strong>withInitialCommands()</strong>: Dispatching commands for initial setup</li><li><strong>dispatch()</strong>: Executing the main test command</li><li><strong>doAction()</strong>: Running arbitrary code during the test</li><li><strong>testEvents()</strong>: Comprehensive event assertions including count, type, and content verification</li><li><strong>testProjections()</strong>: Verifying projection updates with exact counts</li><li><strong>testThat()</strong>: Custom assertion logic</li><li><strong>expectException()</strong>: Testing business rule violations</li><li><strong>Multiple plays</strong>: Three sequential plays representing different phases of the workflow</li></ul><h2 id=using-assertionstrait>Using AssertionsTrait<a class=anchor href=#using-assertionstrait>#</a></h2><p>The <code>AssertionsTrait</code> (included in your base test case) provides helpful assertions for working with scenarios:</p><p><strong>Event assertions:</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// Assert an event was published
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContain</span>(<span style=color:#a6e22e>CourseDefinedEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, $events);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Assert only a specific event type was published
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContainOnly</span>(<span style=color:#a6e22e>CourseDefinedEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, $events);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Assert exact count of specific events
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsContainExactly</span>([
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CourseDefinedEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CourseCapacityChangedEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>], $events);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Assert total event count
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsCount</span>(<span style=color:#ae81ff>3</span>, $events);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Assert an event was NOT published
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsDoNotContain</span>(<span style=color:#a6e22e>CourseDeletedEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, $events);</span></span></code></pre></td></tr></table></div></div><p><strong>Projection assertions:</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// Assert a projection was updated
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertUpdatedProjectionsContain</span>(<span style=color:#a6e22e>CourseProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, $projections);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Assert only a specific projection type was updated
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertUpdatedProjectionsContainOnly</span>(<span style=color:#a6e22e>CourseProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, $projections);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Assert exact count of updated projections
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertUpdatedProjectionsContainExactly</span>([
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CourseProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>StudentProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>], $projections);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Assert total projection update count
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertUpdatedProjectionsCount</span>(<span style=color:#ae81ff>3</span>, $projections);</span></span></code></pre></td></tr></table></div></div><h2 id=chaining-play-methods>Chaining Play methods<a class=anchor href=#chaining-play-methods>#</a></h2><p>All Play methods return a new instance, allowing fluent chaining:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>scenario</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>play</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Play</span>()
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>withInitialCommands</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DefineCourseCommand</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#e6db74>&#39;PHP Basics&#39;</span>, <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ChangeCourseCapacityCommand</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#ae81ff>20</span>))
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testEvents</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>PublishedEvents</span> $events) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertPublishedEventsCount</span>(<span style=color:#ae81ff>1</span>, $events);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testProjections</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>UpdatedProjections</span> $projections) {
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertUpdatedProjectionsContain</span>(<span style=color:#a6e22e>CourseProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, $projections);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>testThat</span>(<span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>            $projection <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>projectionStore</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>find</span>(<span style=color:#e6db74>&#39;123&#39;</span>, <span style=color:#a6e22e>CourseProjection</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertEquals</span>(<span style=color:#ae81ff>20</span>, $projection<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCapacity</span>());
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>);</span></span></code></pre></td></tr></table></div></div><h2 id=testing-models-in-isolation>Testing models in isolation<a class=anchor href=#testing-models-in-isolation>#</a></h2><p>You can test models directly without scenarios for unit-level tests:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>test_course_capacity_model_enforces_rules</span>()<span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    $model <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CourseCapacityModel</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Apply initial state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $initialEvents <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RecordedEventStream</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>RecordedEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>create</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CourseDefinedEvent</span>(<span style=color:#e6db74>&#39;course-123&#39;</span>, <span style=color:#e6db74>&#39;PHP Basics&#39;</span>, <span style=color:#ae81ff>10</span>),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Metadata</span>(),
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DateTimeImmutable</span>()
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    $model<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>applyEvents</span>($initialEvents);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Execute business logic
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $model<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>change</span>(<span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Assert recorded events
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    $changes <span style=color:#f92672>=</span> $model<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getChanges</span>();
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertCount</span>(<span style=color:#ae81ff>1</span>, $changes);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    $recordedEvent <span style=color:#f92672>=</span> <span style=color:#a6e22e>iterator_to_array</span>($changes)[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertInstanceOf</span>(<span style=color:#a6e22e>CourseCapacityChangedEvent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>class</span>, $recordedEvent<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getEvent</span>());
</span></span><span style=display:flex><span>}</span></span></code></pre></td></tr></table></div></div><p>This approach tests model logic in isolation without involving the command dispatcher, event bus, or projections. Use
<code>applyEvents()</code> with a <code>RecordedEventStream</code> to set up the model&rsquo;s initial state, just like <code>withInitialEvents()</code> in
scenarios.</p><h2 id=best-practices>Best practices<a class=anchor href=#best-practices>#</a></h2><p><strong>Set up state with withInitialCommands().</strong> Use <code>withInitialCommands()</code> to establish initial state rather than
manipulating stores directly; this ensures events are published and projections are updated correctly.</p><p><strong>Keep scenarios focused.</strong> Each test should verify one behavior; avoid testing multiple unrelated behaviors in a single
scenario.</p><p><strong>Test both success and failure.</strong> Write scenarios for both successful operations and business rule violations using
<code>expectException()</code>.</p><p><strong>Leverage AssertionsTrait.</strong> Use the provided assertions (<code>assertPublishedEventsContain()</code>,
<code>assertUpdatedProjectionsContain()</code>) rather than writing custom assertion logic.</p><p><strong>Chain multiple plays for workflows.</strong> When testing multi-step processes, create separate plays for each step and
execute them together via <code>scenario->play($play1, $play2)</code>.</p><p><strong>Use @doesNotPerformAssertions for exception tests.</strong> When using <code>expectException()</code> without additional assertions, add
the <code>@doesNotPerformAssertions</code> PHPUnit annotation to avoid warnings.</p><hr></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/backslash/testing/setting-up-tests/ class="flex align-center"><img src=/backslash/icons/backward.svg class=book-icon alt=Previous title="Setting Up Tests">
<span>Setting Up Tests</span>
</a></span><span><a href=/backslash/customization/extending-with-middleware/ class="flex align-center"><span>Extending with Middleware</span>
<img src=/backslash/icons/forward.svg class=book-icon alt=Next title="Extending with Middleware"></a></span></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#understanding-scenarios>Understanding scenarios</a></li><li><a href=#writing-basic-scenarios-with-play>Writing basic scenarios with Play</a></li><li><a href=#setting-up-initial-state>Setting up initial state</a></li><li><a href=#dispatching-commands>Dispatching commands</a></li><li><a href=#executing-actions>Executing actions</a></li><li><a href=#asserting-on-published-events>Asserting on published events</a></li><li><a href=#asserting-on-updated-projections>Asserting on updated projections</a></li><li><a href=#custom-assertions>Custom assertions</a></li><li><a href=#testing-business-rule-violations>Testing business rule violations</a></li><li><a href=#chaining-multiple-plays>Chaining multiple plays</a></li><li><a href=#complete-scenario-example>Complete scenario example</a></li><li><a href=#using-assertionstrait>Using AssertionsTrait</a></li><li><a href=#chaining-play-methods>Chaining Play methods</a></li><li><a href=#testing-models-in-isolation>Testing models in isolation</a></li><li><a href=#best-practices>Best practices</a></li></ul></nav></div></aside></main></body></html>